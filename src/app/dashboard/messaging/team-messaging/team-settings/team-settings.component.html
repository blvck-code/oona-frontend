<div class="create-dialog">
  <div class="d-flex justify-content-end mb-2" >
    <i style="cursor: pointer" mat-dialog-close (click)="closeTeamSettings()" class="bi bi-x fa-2x close-btn"></i>
  </div>
  <h4 class="mt-n4 p-1 d-flex justify-content-center">Team Settings</h4>

  <div class="row">
    <div class="col">
      <div class="d-flex justify-content-between">
        <div>
          <button type="button" class="btn btn-primary btn-sm shadow-none p-2 me-2" (click)="showSubscribedTeams()">Subscribed</button>
          <button type="button" class="btn btn-primary btn-sm shadow-none p-2" (click)="showAllAvailableTeams()">All streams</button>
        </div>
        <div class="d-flex justify-content-between">
          <input type="text" (keyup)="searchTeam($event)" class="form-control shadow-none team-search p-2" placeholder="Filter team" aria-label="team name" aria-describedby="basic-addon1">
          <i class="bi bi-plus-circle add-team p-2" title="Add a team" (click)="createTeam()"></i>
        </div>
      </div>
      <div class="team-names mt-3">
        <ul class="list-group">
          <li *ngFor="let team of filteredTeams" class="specific-team list-group-item list-group-item-action" (click)="selectTeam(team)">
            <p class="">{{team.name}}</p>
            <small class="fst-italic mt-0 pt-0">{{ team.description }}</small>
          </li>
        </ul>

      </div>
    </div>
    <div class="col create-stream">
      <div *ngIf="teamOfChoice">
        <div>
          <div class="d-flex justify-content-between">
            <h5>{{teamOfChoice.name}}</h5>
            <button type="button" class="btn btn-primary p-2 btn-sm shadow-none" (click)="unsubscribeFromTeam()">Unsubscribe</button>
          </div>
          <p *ngIf="teamOfChoice.description">{{teamOfChoice.description}}</p>
          <p *ngIf="teamOfChoice.description == ''">No description for this team yet</p>
        </div>

                <div class="d-flex justify-content-end">
                  <ul class="searchable-users list-group">
                    <li *ngFor="let show of searchResult" class="list-group-item filtered-user" (click)="addMemberToTeam(show)">
                      {{ show.full_name }}
                    </li>
                  </ul>
                </div>
        <div class="d-flex justify-content-around">
          <input type="text" class="form-control shadow-none team-search p-2" placeholder="Search subscribers" aria-label="search" aria-describedby="basic-addon1" (keyup)="searchSubscriber($event)" >
          <input type="text" class="form-control shadow-none team-search p-2" placeholder="Name or email" aria-label="Name" aria-describedby="basic-addon1" [(ngModel)]="selectedUser.full_name" (keyup)="searchUser($event)">
          <button type="button" class="btn btn-primary p-2 btn-sm shadow-none" (click)="subscribeNewMember()" [disabled]="this.selectedUser.full_name == '' ">Add</button>
        </div>

        <div class="">
          <div class="user-names mt-4">
            <ul class="list-group">
              <li *ngFor="let user of filteredGroupMembers" class="list-group-item d-flex justify-content-between team-member">
                <span class="member-detail">{{user.full_name}}</span>
                <span class="member-detail">{{user.email}}</span>
              </li>
            </ul>
          </div>

        </div>
      </div>

      <div *ngIf="!teamOfChoice" >
        <form class="create-stream-wrap" [formGroup]="streamForm">

          <div class="create-stream-content">
            <div class="stream-naming">
              <div class="form-group stream-name">
                <label>Stream name</label>
                <input type="text" class="form-control" placeholder="Stream name">
              </div>
              <div class="form-group pt-2">
                <label>Stream description</label>
                <input type="text" class="form-control" placeholder="Stream description">
              </div>
            </div>

            <div class="stream-privacy">
              <h6 class="modal-meeting-names mb-2">Who can access the stream? </h6>
              <div class="modal-meeting-names mb-2">

                <div class="form-check ">
                  <input formControlName="public"  value="true" class="form-check-input" type="radio" name="public" id="public"  >
                  <label class="form-check-label" for="public">
                    <b>Public</b>: Organization members can join (guests must be invited by a subscriber); organization members can view complete message history without joining
                  </label>
                </div>

                <div class="form-check">
                  <input formControlName="public" value="true" class="form-check-input" type="radio" name="public" id="teamInvite" >
                  <label class="form-check-label" for="teamInvite">
                    <b>Private, shared history</b>: Must be invited by a subscriber; new subscribers can view complete message history; hidden from non-administrator users
                  </label>
                </div>

                <div class="form-check">
                  <input formControlName="public" value="true" class="form-check-input"  type="radio" name="public" id="teamHistory" >
                  <label class="form-check-label" for="teamHistory">
                    <b>Private, protected history</b>: Must be invited by a subscriber; new subscribers can only see messages sent after they join; hidden from non-administrator users
                  </label>
                </div>

              </div>

              <div class="form-check pt-2 pb-2">
                <input type="checkbox" class="form-check-input" id="exampleCheck1">
                <label class="form-check-label text-muted" for="exampleCheck1">Announce stream</label>
              </div>

              <div class="stream-select-sender">
                <label>Who can post to the stream?</label>
                <select class="form-select" aria-label="Default select example">
                  <option selected>Everyone</option>
                  <option value="1">Admins, moderators and full members</option>
                  <option value="1">Admins and moderators</option>
                  <option value="1">Admins only</option>
                </select>
              </div>
            </div>

            <div class="stream-users py-2">

              <div>
                <div class="form-group stream-filter-users">
                  <label>Choose subscribers</label>

                  <div *ngIf="filterWord">
                    <div *ngFor="let member of (users$ | async) | userFilter: filterWord" class="stream-filter-users-list list-group">
                      <button type="button" class="list-group-item list-group-item-action" (click)="addSingleUser(member)">
                        <b>{{ member.full_name }}</b> <span>{{ member.email }}</span>
                      </button>
                    </div>
                  </div>
                  <div class="list-pm-members">
                    <div class="pm-member" *ngFor="let member of oneByOneUser" (click)="removeFromOneByOneUser(member)">
                      <p>{{member.full_name}}</p>
                      <i class="bi bi-x"></i>
                    </div>
                  </div>
                  <div class="d-flex">
                    <input
                      [(ngModel)]="filterWord"
                      [ngModelOptions]="{standalone: true}"
                      type="text"
                      class="form-control"
                      placeholder="Add subscribers. Use usergroup or #streamname to bulk add subscribers">
                    <button class="btn btn-sm btn-dark ms-2">Add</button>
                  </div>
                </div>

                <div class="stream-add-all d-flex justify-content-start py-3">
                  <span>Do you want to add everyone?</span>
                  <button (click)="addAllUsers()" class="btn btn-sm btn-dark ms-3">Add all users</button>
                </div>
              </div>

              <div class="stream-subscribers">
                <div class="stream-subscribers-top py-2 d-flex justify-content-between">
                  <h5>Subscribers</h5>
                  <div class="form-group">
                    <input [(ngModel)]="searchText" [ngModelOptions]="{standalone: true}" type="text" class="form-control" placeholder="Filter subscribers">
                  </div>
                </div>

                <table class="table">
                  <thead class="thead-dark">
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">User ID</th>
                    <th scope="col">Action</th>
                  </tr>
                  </thead>
                  <tbody *ngFor="let member of selectedSubscribers | userFilter: searchText">

                  <tr>
                    <th scope="row">{{ member.full_name}} {{ member.user_id === (userId$ | async) ? '(you)' : ''}}</th>
                    <td>{{ member.email}}</td>
                    <td>{{ member.user_id }}</td>
                    <td>
                      <button *ngIf="member.user_id === (userId$ | async)" disabled class="btn btn-sm btn-danger">Remove</button>
                      <button *ngIf="member.user_id !== (userId$ | async)" (click)="removeUser(member.user_id)" class="btn btn-sm btn-danger">Remove</button>
                    </td>
                  </tr>

                  </tbody>
                </table>

              </div>
            </div>
          </div>

          <div class="stream-buttons d-flex justify-content-end">
            <button class="btn btn-default mx-2 btn-sm">Cancel</button>
            <button class="btn btn-primary mx-2 btn-sm">Create</button>
          </div>

        </form>
      </div>
    </div>
  </div>

</div>
